import { useState } from "react";
import {
  ScrollView,
  Text,
  View,
  Image,
  Pressable,
  TextInput,
  Alert,
} from "react-native";
import { Feather } from "@expo/vector-icons";
import { useRouter } from "expo-router";

import { Screen } from "@/components/layout/Screen";
import { EnhancedButton } from "@/components/ui";
import { LoadingState } from "@/components/common/LoadingState";
import { useSettings } from "@/contexts/SettingsContext";
import { getLocalizedValue } from "@/utils";

export default function ContactUsScreen() {
  const router = useRouter();
  const { storeCustomization, isLoading } = useSettings();
  const contactUs = (storeCustomization as any)?.contact_us;

  const [formData, setFormData] = useState({
    name: "",
    email: "",
    subject: "",
    message: "",
  });

  const handleSubmit = () => {
    if (!formData.name || !formData.email || !formData.message) {
      Alert.alert("Error", "Please fill in all required fields");
      return;
    }
    Alert.alert(
      "Success",
      "Your message has been sent successfully. We will contact you shortly."
    );
    setFormData({ name: "", email: "", subject: "", message: "" });
  };

  if (isLoading) {
    return <LoadingState message="Loading..." />;
  }

  return (
    <Screen className="pt-0" innerClassName="px-0" edges={["top", "bottom"]}>
      <ScrollView
        showsVerticalScrollIndicator={false}
        contentContainerStyle={{ paddingBottom: 100 }}
      >
        {/* Header */}
        <View className="relative h-48 bg-gradient-to-b from-primary-600 to-accent-600">
          <Image
            source={{
              uri:
                contactUs?.header_bg || "https://via.placeholder.com/800x300",
            }}
            className="absolute inset-0 h-full w-full opacity-20"
            resizeMode="cover"
          />
          <View className="absolute inset-0 flex-1 items-center justify-center px-5">
            <Pressable
              onPress={() => router.back()}
              className="absolute left-4 top-12 h-10 w-10 items-center justify-center rounded-full bg-white/20"
            >
              <Feather name="arrow-left" size={24} color="#fff" />
            </Pressable>
            <Text className="font-display text-3xl font-bold text-white">
              {getLocalizedValue(contactUs?.title) || "Contact Us"}
            </Text>
          </View>
        </View>

        {/* Contact Cards */}
        <View className="px-5 py-8">
          <View className="mb-6 gap-4">
            {/* Email Card */}
            <View className="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
              <View className="mb-3 h-12 w-12 items-center justify-center rounded-full bg-primary-100">
                <Feather name="mail" size={24} color="#1c7646" />
              </View>
              <Text className="mb-2 text-xl font-bold text-slate-900">
                {getLocalizedValue(contactUs?.email_box_title) || "Email Us"}
              </Text>
              <Text className="mb-1 text-base font-semibold text-primary-600">
                {getLocalizedValue(contactUs?.email_box_email) ||
                  "support@kachabazar.com"}
              </Text>
              <Text className="text-slate-600">
                {getLocalizedValue(contactUs?.email_box_text) ||
                  "Send us your query anytime!"}
              </Text>
            </View>

            {/* Phone Card */}
            <View className="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
              <View className="mb-3 h-12 w-12 items-center justify-center rounded-full bg-blue-100">
                <Feather name="phone" size={24} color="#3b82f6" />
              </View>
              <Text className="mb-2 text-xl font-bold text-slate-900">
                {getLocalizedValue(contactUs?.call_box_title) || "Call Us"}
              </Text>
              <Text className="mb-1 text-base font-semibold text-blue-600">
                {getLocalizedValue(contactUs?.call_box_phone) ||
                  "+1 (555) 123-4567"}
              </Text>
              <Text className="text-slate-600">
                {getLocalizedValue(contactUs?.call_box_text) ||
                  "We are available 24/7"}
              </Text>
            </View>

            {/* Address Card */}
            <View className="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
              <View className="mb-3 h-12 w-12 items-center justify-center rounded-full bg-orange-100">
                <Feather name="map-pin" size={24} color="#f97316" />
              </View>
              <Text className="mb-2 text-xl font-bold text-slate-900">
                {getLocalizedValue(contactUs?.address_box_title) || "Visit Us"}
              </Text>
              <Text className="mb-1 text-base font-semibold text-orange-600">
                {getLocalizedValue(contactUs?.address_box_address) ||
                  "123 Main Street"}
              </Text>
              <Text className="text-slate-600">
                {getLocalizedValue(contactUs?.address_box_text) ||
                  "Come visit our store"}
              </Text>
            </View>
          </View>

          {/* Contact Form */}
          <View className="rounded-2xl bg-white p-6 shadow-lg">
            <Text className="mb-6 font-display text-2xl font-bold text-slate-900">
              Send us a Message
            </Text>

            <View className="gap-4">
              <View>
                <Text className="mb-2 text-sm font-semibold text-slate-700">
                  Name *
                </Text>
                <TextInput
                  value={formData.name}
                  onChangeText={(text) =>
                    setFormData({ ...formData, name: text })
                  }
                  placeholder="Your full name"
                  className="rounded-xl border border-slate-300 bg-slate-50 px-4 py-3 text-base text-slate-900"
                  placeholderTextColor="#94a3b8"
                />
              </View>

              <View>
                <Text className="mb-2 text-sm font-semibold text-slate-700">
                  Email *
                </Text>
                <TextInput
                  value={formData.email}
                  onChangeText={(text) =>
                    setFormData({ ...formData, email: text })
                  }
                  placeholder="your.email@example.com"
                  keyboardType="email-address"
                  autoCapitalize="none"
                  className="rounded-xl border border-slate-300 bg-slate-50 px-4 py-3 text-base text-slate-900"
                  placeholderTextColor="#94a3b8"
                />
              </View>

              <View>
                <Text className="mb-2 text-sm font-semibold text-slate-700">
                  Subject
                </Text>
                <TextInput
                  value={formData.subject}
                  onChangeText={(text) =>
                    setFormData({ ...formData, subject: text })
                  }
                  placeholder="What is this about?"
                  className="rounded-xl border border-slate-300 bg-slate-50 px-4 py-3 text-base text-slate-900"
                  placeholderTextColor="#94a3b8"
                />
              </View>

              <View>
                <Text className="mb-2 text-sm font-semibold text-slate-700">
                  Message *
                </Text>
                <TextInput
                  value={formData.message}
                  onChangeText={(text) =>
                    setFormData({ ...formData, message: text })
                  }
                  placeholder="Tell us more about your inquiry..."
                  multiline
                  numberOfLines={6}
                  textAlignVertical="top"
                  className="rounded-xl border border-slate-300 bg-slate-50 px-4 py-3 text-base text-slate-900"
                  placeholderTextColor="#94a3b8"
                  style={{ minHeight: 120 }}
                />
              </View>

              <EnhancedButton
                title="Send Message"
                onPress={handleSubmit}
                className="mt-4"
              />
            </View>
          </View>
        </View>
      </ScrollView>
    </Screen>
  );
}
